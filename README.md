# Quasi-find

Quasi-find は、型付き DSL を用いてファイルシステムを検索する、OCaml 製のコマンドラインツールです。Unix の `find` コマンドの代替を目指していますが、より表現力の高いクエリ言語を提供します。

## 特長

- **型付き DSL**: `size > 10MB` や `mtime < 7d` のように、型安全な式で検索条件を記述できます。
- **高速な走査**: `Eio` を用いた並列走査により、大規模なディレクトリツリーも効率的に検索できます。
- **正規表現**: ファイル名やパスに対して PCRE 正規表現 (`=~`) を利用可能です。
- **直感的な単位**: `KB`, `MB`, `GB` や `s` (秒), `m` (分), `h` (時間), `d` (日) などの単位を直接扱えます。

## インストール

```bash
dune build
dune install
```

## 使い方

```bash
quasifind [DIR] "EXPR" [OPTIONS]
```

### 例

カレントディレクトリから、名前が `.log` で終わるファイルを検索:

```bash
quasifind . 'name =~ /\.log$/'
```

`src` ディレクトリ以下の、サイズが 10MB 以上かつ更新が 7 日以内のファイルを検索:

```bash
quasifind src 'size > 10MB && mtime < 7d'
```

1GB 以上のファイルを並列度 4 で検索:

```bash
quasifind /data 'size >= 1GB' -j 4
```

### オプション

- `-d DEPTH`, `--max-depth=DEPTH`: 探索する最大深度を指定します。
- `--exclude-hidden`: 隠しファイル・ディレクトリ（.で始まるもの）を除外します。
- `-h`: ヘルプを表示します。
- `-j JOBS`, `--jobs=JOBS`: 並列実行するジョブ数（スレッド数）を指定します。デフォルトは 1 です。
- `-L`, `--follow`: シンボリックリンクを追跡します。

## クエリ言語

- **フィールド**: `name`, `path`, `type`, `size`, `mtime`
- **演算子**: `==`, `!=`, `<`, `<=`, `>`, `>=`, `=~` (正規表現)
- **論理演算**: `&&` (AND), `||` (OR), `!` (NOT)
- **値**:
  - 文字列: `"sample.txt"`
  - 正規表現: `/^test_.*\.ml$/`
  - ファイルタイプ: `file`, `dir`, `symlink`
  - サイズ: `123`, `10KB`, `1.5GB`
  - 時間: `10s`, `5m`, `24h`, `7d`

### 正規表現について

`name` および `path` フィールドに対して、`=~` 演算子を用いて正規表現によるマッチングが可能です。

- **構文**: `/pattern/` の形式で記述します。中身は PCRE (Perl Compatible Regular Expressions) 互換の構文をサポートしています（OCaml `re` ライブラリを使用）。
- **フラグ**: 現在フラグ指定（`i` など）はサポートしていません。デフォルトで大文字小文字を区別します。
- **エスケープ**: スラッシュ `/` をパターンに含める場合は `\/` とエスケープしてください。

**例**:

- 拡張子が `.ml` または `.mli`: `name =~ /\.(ml|mli)$/`
- 先頭が `test_` で始まる: `name =~ /^test_/`
- 特定ディレクトリ `_build` を含まないパス: `path =~ /^(?!.*_build\/).*$/` (否定先読みなどが使えるかは `re` の PCRE サポート状況に依存しますが、基本的な互換性はあります)

## ライセンス

MIT License
